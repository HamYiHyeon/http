<!DOCTYPE html> 
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>inventory</title>

    <style>
        * {
            margin: 0;
            padding: 0;
        }
        #zoom {
            display: none;
            position: absolute;
            top: 0;
            left: 35vw;

        }
        #zo {
            display: block;
            position: relative;
            background: rgba(255, 255, 255, 0.5);
            top: 15vh;
            width: 30vw;
            height: 30vw;
            cursor: pointer;
            margin: auto;
            z-index: 10;
        }
        #screen1 {
            height: 100vh;
            width: 100vw;
            background: url("기숙사방.png");
            background-repeat: no-repeat;   
            background-size: cover;
        }
        #screen2 {
            height: 100vh;
            width: 100vw;
            background: url("복도.png");
            background-repeat: no-repeat;   
            background-size: cover;
        }
        #screen3 {
            height: 100vh;
            width: 100vw;
            background: url("세탁실.png");
            background-repeat: no-repeat;   
            background-size: cover;
        }
        #screen4 {
            height: 100vh;
            width: 100vw;
            background: url("지하실문.png");
            background-repeat: no-repeat;
            background-size: cover;
        }
        #screen5 {
            height: 100vh;
            width: 100vw;
            background: url("지하계단.png");
            background-repeat: no-repeat;
            background-size: cover;
        }
        #screen6 {
            height: 100vh;
            width: 100vw;
            background: url("지하실.png");
            background-repeat: no-repeat;
            background-size: cover;
        }
        #screen7 {
            height: 100vh;
            width: 100vw;
            background: url("중앙현관.png");
            background-repeat: no-repeat;
            background-size: cover;
        }
        #screen8 {
            height: 100vh;
            width: 100vw;
            background: url("게임클리어.png");
            background-repeat: no-repeat;
            background-size: cover;
        }
        #itembox {
            width: 6vw;
            height: 90vh;
            float: left;
            background: rgba(100, 100, 100, 0.7);
        }
        .object {
            width: 94vw;
            height: 100vh;
            position: absolute;
            cursor: pointer;
            z-index: 1;
            opacity: 0.3;
        }
        .item{
            cursor: pointer;
        }
        #drawerKey{
            clip-path: polygon(80.7vw 80.3vh, 81.7vw 74vh, 77.8vw 71vh, 76.8vw 76.3vh);
        }
        #closet{
            clip-path: polygon(23.5vw 36vh, 38vw 36vh, 38vw 72vh, 28vw 80vh, 25vw 76vh);
        }
        #drawer{
            clip-path: polygon(50vw 47.7vh, 55.5vw 49vh, 55.5vw 55.5vh, 50vw 54vh);
        }
        #door1{
            clip-path: polygon(0 23vh, 30vh 25vh, 36vh 83vh, 0 97vh);
        }
        #door2{           
            clip-path: polygon(100vw 20vh, 80vw 23vh, 75vw 93vh, 100vw 113vh);
        }
        #room101{
            width: 24.6vh;
            height: 48vh;
            left: 17.5vw;
            top: 29vh;
        }
        #LaundryRoom{
            width: 24.6vh;
            height: 48vh;
            left: 70.5vw;
            top: 29vh;
        }
        #board{
            clip-path: polygon(45vw 24vh, 65vw 19vh, 64vw 47vh, 45vw 43vh);
        }
        #bloodyShirt1{
            clip-path: polygon(17vw 40vh, 19vw 40vh, 18vw 41vh, 17vw 40vh);
            opacity: 1;
        }
        #bloodyShirt2{
            clip-path: polygon(48vw 53vh, 51vw 52vh, 49vw 50vh, 49vw 50vh);
            opacity: 1;
        }
        #bloodyShirt3{
            clip-path: polygon(17vw 40vh, 19vw 40vh, 18vw 41vh, 17vw 40vh);
            opacity: 1;
        }
        #bloodyShirt4{
            clip-path: polygon(48vw 53vh, 51vw 52vh, 49vw 50vh, 49vw 50vh);
            opacity: 1;
        }
        #washingMachine{
            clip-path: ellipse(95px 75px at 69.5% 46%);
            transform: rotateZ(45deg);
        }
        #secretPath{
            clip-path: ellipse(80px 68px at 16% 61%);
        }
        #basementDoor{
            clip-path: polygon(33vw 35vh, 55vw 35vh, 55vw 72vh, 33vw 72vh);
        }
        #laundryRoomPassword{
            clip-path: polygon(56vw 41vh, 58vw 40vh, 58vw 48vh, 56vw 48vh);
        }
        #toBasement{
            clip-path: polygon(37vw 35vh, 51vw 35vh, 53vw 60vh, 35vw 60vh);
        }
        #note{
            clip-path: polygon(30vw 43vh, 32vw 43vh, 31vw 46vh, 28vw 46vh);
        }
        #toEntrance{
            display: none;
            position: absolute;
            left: 45vw;
            top: 40vh;
            width: 300px;
            height: 150px;
            opacity: 1;
        }
        #entranceLock{
            position: absolute;
            left: 6vw;
            clip-path: polygon(40vw 55vh, 42vw 55vh, 42vw 61vh, 40vw 61vh);
        }

        #dialLockBackground{
            display: none;
            position: fixed;
            top: 12.5vw;
            left: 45vh;
            width: 50vw;
            height: 60vh;
            opacity: 0.3;
            z-index: 100;
        }
        #dialLockModal{
            display: none;
            position: fixed;
            top: 30%;
            left: 17%;
            width: 60vw;
            height: 50vh;
            z-index: 1000;
        }
        #dialLock{
            display: none;
            width: 100%;
            height: 100%;
            border: none;
        }
        #dialLockCloseButton{
            position: absolute;
            top: 0vh;
            left: 50vw;
            height: 5vh;
            width: 2.5vw;
        }
        #timer{
            display: none;
            position: absolute;
            top: 5vh;
            left: 80vw;
            background-color: transparent;
            border: none;
            font-size: 40px;
        }
        #entranceDoor {
            position: absolute;
            left: 6vw;
            display: none;
            clip-path: polygon(30vw 23vh, 52vw 23vh, 52vw 85vh, 30vw 85vh);
        }

    </style>

    <script>
        let imgSrc = {
            열쇠: '그림3.png',
            커서: "그림4.svg",
            유령: "그림5.svg",
            자물쇠: "자물쇠_잠금.svg",
            열림: "자물쇠_열림.svg",
            메모2: "memo2.png",
            피옷1: "blood_shirts_1.png",
            피옷2: "blood_shirts_2.png",
            피옷3: "blood_shirts_3.png",
            피옷4: "blood_shirts_4.png",
            힌트옷1: "hint_shirts_1.png",
            힌트옷2: "hint_shirts_2.png",
            힌트옷3: "hint_shirts_3.png",
            힌트옷4: "hint_shirts_4.png",
            쪽지: "memo3.png",
            문제2: "question2.png"
            };
        let isNoteTransition = false;
        let noteStep = 0;

        function ItemInsert(obj) {
            console.log(obj);
            let bool = true;
            let newItem = document.createElement("img");
            newItem.src = imgSrc[obj.alt];
            newItem.style.height = "6vw";
            newItem.style.width = "6vw";
            newItem.className="item";
            newItem.alt = obj.alt;

            if(typeof obj.getAttribute === 'function') {
                if(obj.hasAttribute('key')) {
                        newItem.setAttribute('key', obj.getAttribute('key'));
                        console.log(newItem);
                }
            }
            else{
                if('key' in obj){
                    newItem.setAttribute('key', obj.key);
                }
                console.log(newItem);
            }

            if(obj.id != "ghost" && obj.id != "shirts" && !obj.id.startsWith("blood") && obj.id != "memoModalImg" && obj.id != "note" && obj.id != "question2") newItem.onclick = function() {alert(obj.alt);};
            else if(obj.id === "note") {
                newItem.onclick = function() {
                    zo.src = newItem.src;
                    zoom.style.display = "block";
                    isNoteTransition = true;
                    let noteStep = 0;
                }
            }
            else {
                newItem.onclick = function() {
                    zo.src = newItem.src;
                    zoom.style.display = "block";
                }
            }
            document.getElementById("itembox").appendChild(newItem);
            if(obj.src !== undefined) 
            {
                obj.style.display = 'none';
            }
        }

        function ToggleNoteZoom() {

            if(noteStep === 0) {
                zo.src = "memo4.png";
                noteStep++;
            }
            else if(noteStep === 1) {
                zo.src = "question2.png";
                noteStep++;
                timer();
                document.getElementById('toEntrance').style.display = 'block';
            }
            else {
                let items = document.getElementsByClassName("item");

                ItemInsert({id: "question2", alt: "문제2"});
                zoom.style.display = "none";

                for (let i = 0; i < items.length; i++) {
                    if(items[i].alt === "쪽지") {
                        items[i].remove();
                        break;
                    }
                }

                isNoteTransition = false;
            }
        }
        function DeleteShirts(obj) {
            let items = document.getElementsByClassName("item");
            let bloodyShirtCount = 0;
            let hintShirtCount = 0;
            let beDeletedItem = [];
            if(obj === 'bloodyShirt') {
                for (let i = 0; i < items.length; i++) {
                    if (items[i].alt.startsWith("피옷")) {
                        bloodyShirtCount++;
                        beDeletedItem.push(items[i]);
                    }
                }
                if (bloodyShirtCount === 4) {
                    for(let i = 0; i < 4; i++) {
                        beDeletedItem[i].remove();
                    }
                    InsertHintShirts();
                }
            }
            else if(obj === 'hintShirt') {
                for (let i = 0; i < items.length; i++) {
                    if (items[i].alt.startsWith("힌트옷")) {
                        hintShirtCount++;
                        beDeletedItem.push(items[i]);
                    }
                }
                if(hintShirtCount === 4) {
                    for(let i = 0; i < 4; i++) {
                        beDeletedItem[i].remove();
                    }
                }
            }
        }
        function InsertHintShirts() {
            let hintShirts = ["힌트옷1", "힌트옷2", "힌트옷3", "힌트옷4"];
            for (let i = 0; i < 4; i++) {
                ItemInsert({ id: "shirts", alt: hintShirts[i] });
            }
        }
        function GotoSecretPath() {
            let items = document.getElementsByClassName("item");
            let hintShirtCount = 0;

            for (let i = 0; i < items.length; i++) {
                if (items[i].alt.startsWith("힌트옷")) {
                    hintShirtCount++;
                }
            }
            if(hintShirtCount === 4) {
                document.getElementById('screen3').style.display = 'none';
                document.getElementById('screen4').style.display = 'block';
            }
        }
        function Unlock(lock) {
            let unlock = false
            let items = document.getElementsByClassName("item");
            for (let i = 0; i < items.length; i++) {
                if (items[i].hasAttribute('key') && items[i].getAttribute('key') === lock.getAttribute('need')) {
                    console.log(items[i].getAttribute('key'));
                    console.log(lock.getAttribute('need'));
                    unlock = true
                    items[i].remove();
                    break;
                }
            }
            if(unlock) {
                if(lock.id == "drawer"){
                    ItemInsert({id: 'ghost', alt: '유령'});
                    ItemInsert({alt: '열쇠', key: 'closet'}); 
                }
                lock.style.display = 'none';
                lock.alt = '열림';
            } 
            zo.src = imgSrc[lock.alt]; 
            zoom.style.display = "block";
        }
        function Nonedisplay() {
            if(!isNoteTransition) {
                zoom.style.display = "none";
            }
            else {
                ToggleNoteZoom();
            }
        }
        function dialLock() {
            document.getElementById("dialLockBackground").style.display = 'block';
            document.getElementById("dialLockModal").style.display = 'block';
            document.getElementById("dialLock").style.display = 'block';
            document.getElementById("entranceLock").style.display = 'none';
        }
        function closeLock() {
            document.getElementById("dialLockBackground").style.display = 'none';
            document.getElementById("dialLockModal").style.display = 'none';
            document.getElementById("dialLock").style.display = 'none';
            document.getElementById('entranceLock').style.display = 'block';
            document.getElementById('entranceLock').style.transform = 'translateX("50vw")';

        }
        function ShowImg(imageSrc) {
            let items = document.getElementsByClassName("item");
            for (let i = 0; i < Math.max(1, items.length); i++) {
                if(items.length === 0 || !items[i].alt.startsWith("메모2")) {
                    const memoModal = document.getElementById('memoModal');
                    const memoModalImg = document.getElementById('memoModalImg');
                    const overlay = document.getElementById('overlay');
                    memoModalImg.src = imageSrc;
                    memoModal.style.display = 'block';
                    memoModal.style.display = 'block';
                    document.getElementById('memoModalImg').style.display = 'block';
                }
            }
        }
        function hideModal() {
            const memoModal = document.getElementById('memoModal');
            const overlay = document.getElementById('overlay');
            memoModal.style.display = 'none';
        }

        setInterval(() => {         //DialLock.html의 localStorage API에서 자물쇠 값(lockStatus)을 받아와서 검사
            if (localStorage.getItem('lockStatus') === 'unlocked') {
                closeLock();
                document.getElementById("entranceLock").style.display = 'none';
                document.getElementById("entranceDoor").style.display = 'block';
                localStorage.removeItem('lockStatus');
            }
        }, 1000);


        function timer() {
            const timer = document.getElementById('timer');
            let time = 300000; //5분 타이머
            timer.style.display = 'block';

            setInterval(function() {time -= 1000; if(time >= 0) timer.value = '제한시간 : ' + time / 1000 + '초';}, 1000);   //1초마다 printTimer 실행

            setTimeout(gameOver, 300000);
        }
        function gameOver() {
            if(document.getElementById("timer").style.display !== 'none') {
                alert("게임오버");
                /*게임 오버 띄우기(넣어야함)*/
            }
        }
    </script>
</head>
<body>
    <ol id="itembox"></ol>
    <div id='zoom' style="text-align: center;">
        <img id='zo' src="" onclick="Nonedisplay()">
    </div>
    <article id="screen1" style="margin-left: auto; margin-right: auto; display: block;">
        <div id="div1">
            <img class="object" id="drawerKey" src="흰색.png"
            alt="열쇠" key='drawer' onclick="ItemInsert(this)">
            <img class="object" id="closet" src="흰색.png"
            alt="자물쇠" need = "closet"onclick="Unlock(this)">
            <img class="object" id="drawer" src="흰색.png"
            alt="자물쇠" need = "drawer" onclick="Unlock(this)">
            <img class="object" id="door1" src="흰색.png"
            alt="문" need='방문열쇠' onclick="document.getElementById('screen1').style.display = 'none'; document.getElementById('screen2').style.display = 'block';">
        </div>
    </article>
    <article id="screen2" style="margin-left: auto; margin-right: auto; display: none;">
        <div id="div2">
            <img class="object" id="room101" src="흰색.png"
            alt="문" onclick="document.getElementById('screen2').style.display = 'none'; document.getElementById('screen1').style.display = 'block';">
            <img class="object" id="LaundryRoom" src="흰색.png"
            alt="문" onclick="document.getElementById('screen2').style.display = 'none'; document.getElementById('screen3').style.display = 'block';">
        </div>
    </article>
    <article id="screen3" style="margin-left: auto; margin-right: auto; display: none;">
        <div id="div3">
            <img class="object" id="door2" src="흰색.png"
            alt="문" onclick="document.getElementById('screen3').style.display = 'none'; document.getElementById('screen2').style.display = 'block';">
            <img class="object" id="board" src="흰색.png"
            alt="게시판" onclick="ShowImg('memo2.png')">
            <img class="object" id="bloodyShirt1" src="흰색.png"
            alt="피옷1" onclick="ItemInsert(this); this.style.display = 'none';">
            <img class="object" id="bloodyShirt2" src="흰색.png"
            alt="피옷2" onclick="ItemInsert(this); this.style.display = 'none';">
            <img class="object" id="bloodyShirt3" src="흰색.png"
            alt="피옷3" onclick="ItemInsert(this); this.style.display = 'none';">
            <img class="object" id="bloodyShirt4" src="흰색.png"
            alt="피옷4" onclick="ItemInsert(this); this.style.display = 'none';">
            <img class="object" id="washingMachine" src="흰색.png"
            alt="세탁기" onclick="DeleteShirts('bloodyShirt')">
            <img class="object" id="secretPath" src="흰색.png"
            alt="문" onclick="GotoSecretPath()">
            <div class="memoModal" id="memoModal">
                <img alt="메모2" id="memoModalImg" src="" style="display: none" onclick="ItemInsert(this); hideModal();">
            </div>
        </div>
    </article>
    <article id="screen4" style="margin-left: auto; margin-right: auto; display:none;">
        <div id="div1">
            <img class="object" id="laundryRoomPassword" src="흰색.png"
            alt="자물쇠" onclick="Unlock(this)">
            <img class="object" id="basementDoor" src="흰색.png"
            alt="문" onclick="document.getElementById('screen4').style.display = 'none'; document.getElementById('screen5').style.display = 'block'; DeleteShirts('hintShirt');">
        </div>        
    </article>
    <article id="screen5" style="margin-left: auto; margin-right: auto; display:none;">
        <div id="div1">
            <img class="object" id="toBasement" src="흰색.png"
            alt="문" onclick="document.getElementById('screen5').style.display = 'none'; document.getElementById('screen6').style.display = 'block';">
        </div>        
    </article>
    <article id="screen6" style="margin-left: auto; margin-right: auto; display:none;">
        <div>
            <img class="object" id="note" src="흰색.png"
            alt="쪽지" onclick="ItemInsert(this); this.style.display = 'none';">
            <img class="object" id="toEntrance" src="btnEscape.png"
            alt="문" onclick="document.getElementById('screen6').style.display = 'none'; document.getElementById('screen7').style.display = 'block';">
        </div>        
    </article>
    <article id="screen7" style="margin-left: auto; margin-right: auto; display:none;">
        <div>
            <img class="object" id="entranceLock" src="흰색.png"
            alt="자물쇠" onclick="dialLock(this)">
            <img id="dialLockBackground" src="흰색.png">
            <div id="dialLockModal">
                <iframe id=dialLock src="DialLock.html"></iframe>
                <button id='dialLockCloseButton' onclick="closeLock()">
                    <img src="닫기.png">
                </button>
            </div>
            <img class="object" id="entranceDoor" src="흰색.png"
            alt="문" onclick="document.getElementById('screen7').style.display = 'none'; document.getElementById('screen8').style.display = 'block'; document.getElementById('timer').style.display = 'none';">
        </div>
    </article>
    <article id="screen8" style="margin-left: auto; margin-right: auto; display:none;">
    </article>
    <div>
        <input id = "timer" type="text" value="제한시간 : 300초">
    </div>
</body>
</html>